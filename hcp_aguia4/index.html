
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../zombie/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Slurm basics - CCBL Tutorials</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-acess-aguia4-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CCBL Tutorials" class="md-header__button md-logo" aria-label="CCBL Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CCBL Tutorials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Slurm basics
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CCBL Tutorials" class="md-nav__button md-logo" aria-label="CCBL Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CCBL Tutorials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Linux
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IDE
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../zombie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kill zombie processes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Slurm basics
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Slurm basics
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#login-and-acess" class="md-nav__link">
    <span class="md-ellipsis">
      Login and Acess:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-template" class="md-nav__link">
    <span class="md-ellipsis">
      Job Template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reminders" class="md-nav__link">
    <span class="md-ellipsis">
      Reminders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-how-cores-cpus-are-allocated" class="md-nav__link">
    <span class="md-ellipsis">
      Defining How Cores (CPUs) Are Allocated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chain-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Chain Jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rules-and-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Rules and Recommendations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#login-and-acess" class="md-nav__link">
    <span class="md-ellipsis">
      Login and Acess:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-template" class="md-nav__link">
    <span class="md-ellipsis">
      Job Template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reminders" class="md-nav__link">
    <span class="md-ellipsis">
      Reminders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-how-cores-cpus-are-allocated" class="md-nav__link">
    <span class="md-ellipsis">
      Defining How Cores (CPUs) Are Allocated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chain-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Chain Jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rules-and-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Rules and Recommendations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="how-to-acess-aguia4-cluster">How to acess aguia4 cluster</h1>
<h2 id="login-and-acess">Login and Acess:</h2>
<pre><code class="language-markdown">- SSH: ssh USP_ID@shark.hpc.usp.br
- Password: USP_ID password
- shark ssh aguia4

</code></pre>
<h2 id="utilities">Utilities</h2>
<pre><code class="language-markdown">- sbatch namejob.sh            : Puts `namejob.sh` in the queue
- scancel job_id               : Cancels the job
- squeue --user=nnnn           : Displays the jobs of user `nnnn`
- scontrol show jobid &lt;jobid&gt;  : Shows information about the job with identification `&lt;jobid&gt;`
- module avail                 : Lists the installed programs
</code></pre>
<p>For more: <a href="https://slurm.schedmd.com/pdfs/summary.pdf">slurm workload manager</a></p>
<p><strong>Pay attention!</strong>: Don't use your directory for permanent data storage. After transferring your files, remove them from your directory.</p>
<hr />
<h2 id="job-template">Job Template</h2>
<p>To allow Slurm to allocate more than one job on the same server, use the following job template.</p>
<pre><code class="language-markdown">#!/bin/bash 

#SBATCH --partition=SP2
#SBATCH --ntasks=1            : Number of tasks / MPI processes
#SBATCH --cpus-per-task=1      : Number of threads OpenMP per process
#SBATCH -J aloca-1-cpu
#SBATCH --time=01:02:00        : In case of you don't specify, the default limit is 8 hours. The maximum limit is 192 hours.
#SBATCH --mem-per-cpu=24042     :24 GB of RAM per CPU. Maximum of 480,000 for all CPUs.

#### OpenMP Settings:

export OMP_NUM_THREADS=1
export MKL_NUM_THREADS=1
export OMP_PLACES=threads
export OMP_PROC_BIND=spread
echo $SLURM_JOB_ID        : ID of job allocation
echo $SLURM_SUBMIT_DIR    : Directory job where was submitted
echo $SLURM_JOB_NODELIST  : File containing allocated hostnames
echo $SLURM_NTASKS        : Total number of cores for job

#### Load modules:
module avail : Lists the installed programs
module load NOME_MODULE

#### Run the application:
srun YOUR_EXECUTEFILE_WITH_PARAMETERS_AND_FLAGS

</code></pre>
<p>Examples: </p>
<pre><code class="language-markdown">- more modelo_job-gaussian.sh
- more modelo_job.sh
</code></pre>
<h2 id="reminders">Reminders</h2>
<p>It is essential to specify the required time in a consistent and appropriate manner</p>
<p>If each CPU will use more than 24 GB use in the job header</p>
<pre><code class="language-markdown">#SBATCH --mem VALUE
</code></pre>
<p>Use</p>
<pre><code class="language-markdown">srun
</code></pre>
<p>to run the program within the job script submitted by sbatch.</p>
<hr />
<h2 id="defining-how-cores-cpus-are-allocated">Defining How Cores (CPUs) Are Allocated</h2>
<p>Examples for 16 cores:</p>
<pre><code class="language-markdown">--ntasks=16 : Using MPI, without worrying about core distribution
and to allocate 16 independent processes (without communication)

--ntasks=16 --ntasks-per-node=1 or --ntasks=16 --nodes=16 : To allocate 16 cores distributed across different nodes

--ntasks=16 --nodes=16 --exclusive : To allocate 16 cores distributed across different nodes, without interference from other jobs

--ntasks=16 --ntasks-per-node=2 : For 16 processes distributed across 8 nodes (2 processes per node)
--ntasks=16 --ntasks-per-node=16 : For 16 processes on the same node 

--ntasks=1 --cpus-per-task=16 : For 1 process using 16 cores for multithreading

--ntasks=4 --cpus-per-task=4 : For 4 processes using 4 cores each for multithreading 

</code></pre>
<hr />
<h2 id="chain-jobs">Chain Jobs</h2>
<p>You can organize a sequence of jobs so that one job starts after the completion of another. To do this, submit the first job, note the JobId, and then submit the next one with the following command:</p>
<pre><code class="language-markdown">sbatch submit.sh --dependency=afterany:&lt;JobId&gt;
</code></pre>
<p>In this way, the second job will only start after the completion of the first job.</p>
<hr />
<h2 id="rules-and-recommendations">Rules and Recommendations</h2>
<ul>
<li>The aguia4 cluster supports up to 160 cores for serial and parallel jobs. For parallel jobs requiring more than 160 and up to 900 cores, use the aguia3 cluster.</li>
<li>Don't run programs interactively, use the job queue system.</li>
<li>Read the file /etc/instrucoes.txt for initial commands and tips on how to run jobs.</li>
<li>The job limit per user is 20 jobs.</li>
<li>The maximum queue time is 192 hours.</li>
<li>The maximum number of CPUs per node is 20.</li>
<li>Questions or problems? Send an email to hpc@usp.br.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>